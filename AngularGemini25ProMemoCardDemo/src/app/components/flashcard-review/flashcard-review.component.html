<div class="review-container" *ngIf="currentCard; else noCardsToReview">
  <h2>è¤‡ç¿’å–®å­—å¡</h2>

  <!-- é¡åˆ¥ç¯©é¸å™¨ -->
  <div class="category-filter">
    <h4>ç¯©é¸é¡åˆ¥:</h4>
    <div class="category-options">
      <label class="category-option select-all-label">
        <input type="checkbox" [checked]="areAllCategoriesSelected()" (change)="toggleSelectAllCategories($event)"
          [disabled]="(allCategories$ | async)?.length === 0"> å…¨é¸/å…¨ä¸é¸
      </label>
      <ng-container *ngIf="(allCategories$ | async) as categories">
        <label *ngFor="let category of categories" class="category-option">
          <input type="checkbox" [checked]="selectedCategories.includes(category)"
            (ngModelChange)="onCategorySelectionChange()"> {{ category }}
        </label>
        <p *ngIf="categories.length === 0" class="no-categories-message">
          ç›®å‰æ²’æœ‰ä»»ä½•å¡ç‰‡æˆ–é¡åˆ¥ã€‚è«‹å…ˆæ–°å¢ä¸€äº›å¡ç‰‡ã€‚
        </p>
      </ng-container>
    </div>
  </div>
  <hr>

  <!-- å¡ç‰‡ -->
  <div class="card">
    <div class="card-question">
      <h3>é¡Œç›®:</h3>
      <p>{{ currentCard.lastAnsweredTime ? (currentCard.lastAnsweredTime | date:'yyyy/MM/dd HH:mm') : 'æœªå›ç­”' }} / {{ currentCard.score }} åˆ† / {{ currentCard.answerCount }} æ¬¡</p>
      <small class="card-category-badge" *ngIf="currentCard.category">é¡åˆ¥: {{ currentCard.category }}</small>
      <p>{{ currentCard.question }}</p>
    </div>

    <div style="display: flex; align-items: center;">
      <button style="height: 3rem;" (click)="speakAnswer(answerInput)" title="å¿µå‡ºç­”æ¡ˆ">ğŸ”Š</button>
      <input style="padding: 1rem;margin: 1rem;width: -webkit-fill-available;" [(ngModel)]="answerInput" />
    </div>

    <hr>
    <button (click)="showAnswer = !showAnswer">
      <span *ngIf="!showAnswer">é¡¯ç¤º</span>
      <span *ngIf="showAnswer">éš±è—</span>ç­”æ¡ˆ
    </button>

    <div class="card-answer">
      <button (click)="speakAnswer(currentCard.answer)" title="å¿µå‡ºç­”æ¡ˆ">ğŸ”Š å¿µç­”æ¡ˆ</button>
      <button (click)="openTtsSettings()" title="èªéŸ³è¨­å®š">âš™ï¸ èªéŸ³è¨­å®š</button>
    </div>

    <div class="card-answer" *ngIf="showAnswer">
      <h3>ç­”æ¡ˆ:</h3>
      <p [innerHTML]="currentCard.answer | diffHighlight:answerInput">{{ currentCard.answer }}</p>
    </div>

  </div>

  <div class="answer-actions" *ngIf="showAnswer">
    <button [disabled]="this.currentCard.answer != this.answerInput" (click)="answer(true)" class="know-btn">æˆ‘æœƒäº†
      ğŸ‘</button>
    <button (click)="answer(false)" class="dont-know-btn">æˆ‘ä¸æœƒ ğŸ‘</button>
  </div>

  <!-- <button (click)="drawNextCard()" *ngIf="!showAnswer" class="next-card-btn">
    è·³é / æŠ½ä¸‹ä¸€å¼µ
  </button> -->
</div>

<ng-template #noCardsToReview>
  <p>å¤ªæ£’äº†ï¼ç›®å‰æ²’æœ‰éœ€è¦è¤‡ç¿’çš„å¡ç‰‡ï¼Œæˆ–è€…ä½ é‚„æ²’æœ‰æ–°å¢ä»»ä½•å¡ç‰‡ã€‚</p>
</ng-template>

<app-tts-settings-modal *ngIf="isTtsSettingsModalOpen" (closeModal)="closeTtsSettings()">
</app-tts-settings-modal>
